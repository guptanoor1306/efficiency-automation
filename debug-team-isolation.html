<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Team Isolation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .team-section {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .b2b { border-color: #007bff; }
        .varsity { border-color: #28a745; }
        .harish { border-color: #ffc107; }
        .zero1 { border-color: #dc3545; }
        .btn {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Team Isolation Debug Tool</h1>
        <p>This tool helps diagnose why September appears locked for all teams when only B2B is completed.</p>
        
        <button class="btn" onclick="analyzeAllTeams()">üöÄ Analyze All Teams</button>
        <button class="btn" onclick="clearResults()">üßπ Clear Results</button>
    </div>

    <div id="results"></div>

    <script>
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function analyzeAllTeams() {
            clearResults();
            const resultsDiv = document.getElementById('results');
            
            const teams = ['b2b', 'varsity', 'harish', 'zero1'];
            const teamNames = {
                'b2b': 'B2B Team',
                'varsity': 'Varsity Team', 
                'harish': 'Zero1 - Harish Team',
                'zero1': 'Zero1 Team'
            };
            
            teams.forEach(team => {
                const teamDiv = document.createElement('div');
                teamDiv.className = `container team-section ${team}`;
                teamDiv.innerHTML = `<h2>üè¢ ${teamNames[team]}</h2>`;
                
                // Check finalized reports
                const finalizedKey = `${team}_finalizedReports`;
                const finalizedData = localStorage.getItem(finalizedKey);
                
                if (finalizedData) {
                    try {
                        const reports = JSON.parse(finalizedData);
                        const septemberReports = Object.keys(reports).filter(key => key.includes('2025-09'));
                        
                        teamDiv.innerHTML += `
                            <div class="success">‚úÖ Finalized Reports Found</div>
                            <div>Total finalized weeks: ${Object.keys(reports).length}</div>
                            <div>September 2025 weeks: ${septemberReports.length}</div>
                            <div>September week IDs: ${septemberReports.join(', ')}</div>
                        `;
                    } catch (e) {
                        teamDiv.innerHTML += `<div class="error">‚ùå Error parsing finalized reports: ${e.message}</div>`;
                    }
                } else {
                    teamDiv.innerHTML += `<div class="warning">‚ö†Ô∏è No finalized reports found</div>`;
                }
                
                // Check historical data
                const historicalKey = `${team}_historical_data`;
                const historicalData = localStorage.getItem(historicalKey);
                
                if (historicalData) {
                    try {
                        const historical = JSON.parse(historicalData);
                        const months = Object.keys(historical);
                        const septemberExists = historical['September 2025'];
                        
                        teamDiv.innerHTML += `
                            <div class="success">‚úÖ Historical Data Found</div>
                            <div>Total months: ${months.length}</div>
                            <div>Months: ${months.join(', ')}</div>
                            <div>September 2025 status: ${septemberExists ? '‚úÖ Complete' : '‚ùå Not found'}</div>
                        `;
                        
                        if (septemberExists) {
                            teamDiv.innerHTML += `
                                <div>September isComplete: ${septemberExists.isComplete}</div>
                                <div>September members: ${Object.keys(septemberExists.monthlyData || {}).length}</div>
                            `;
                        }
                    } catch (e) {
                        teamDiv.innerHTML += `<div class="error">‚ùå Error parsing historical data: ${e.message}</div>`;
                    }
                } else {
                    teamDiv.innerHTML += `<div class="warning">‚ö†Ô∏è No historical data found</div>`;
                }
                
                // Check what the app would see for September
                const isCompleteCheck = checkSeptemberComplete(team, historicalData);
                teamDiv.innerHTML += `
                    <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <strong>App Logic Check:</strong><br>
                        September 2025 appears as: ${isCompleteCheck ? 'üîí Locked (Monthly Summary)' : 'üìù Available for Input'}
                    </div>
                `;
                
                resultsDiv.appendChild(teamDiv);
            });
        }
        
        function checkSeptemberComplete(team, historicalDataString) {
            if (!historicalDataString) return false;
            
            try {
                const historical = JSON.parse(historicalDataString);
                return historical['September 2025']?.isComplete === true;
            } catch (e) {
                return false;
            }
        }
    </script>
</body>
</html>
